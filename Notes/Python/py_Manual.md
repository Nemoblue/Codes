# Python Manual

## 函数

函数简介

- 函数是一个对象

- 创建函数：
    ```
    def 函数名([形参1,形参2,...形参n]) :
        代码块
    ```
    - 函数名必须要符号标识符的规范（可以包含字母、数字、下划线、但是不能以数字开头）

- 调用函数：`函数对象()`

---

函数参数

- `形参`（形式参数），定义形参就相当于在函数内部声明了变量，但是并不赋值

- `实参`（实际参数），如果函数定义时，指定了形参，那么在调用函数时也必须传递实参，实参将会赋值给对应的形参

- 定义形参时，可以为形参指定默认值
    ```
    def fn(a = 5 , b = 10 , c = 20):
        print('a =',a)
        print('b =',b)
        print('c =',c)

    fn(1 , 2 , 3)   # a = 1 b = 2 c = 3
    fn()    # a = 5 b = 10 c = 20
    ```

- 实参的传递方式
    - `位置参数`：将对应位置的实参复制给对应位置的形参
    - `关键字参数`：可以不按照形参定义的顺序去传递，而直接根据参数名去传递参数
    - 混合使用关键字和位置参数时，必须将位置参数写到前面

        ```
        fn(1 , 2 , 3)   # 位置参数
        fn(b=1 , c=2 , a=3) # 关键字参数

        # 混合参数
        print('hello' , end='')
        fn(1,c=30)
        ```

- 实参的类型
    - 函数在调用时，解析器**不会检查**实参的类型。实参可以传递任意类型的对象
        ```
        def fn2(a):
            print('a =',a)
            a(1, 2, 3)  # a = 1 b = 2 c = 3

        fn2(fn) # a = <function at 0x123>

        def fn3(a , b):
            print(a+b)

        fn3(123,"456")  # Type Error
        ```

    - 在函数中对形参进行重新赋值，不会影响其他的变量（实参）
        ```
        def fn4(a): 
            a = 20
        
        c = 10
        fn4(c)  # c = 10
        ```

    - 如果形参执行的是一个**对象**，当我们通过形参去修改对象时，会影响到所有指向该对象的变量
        ```
        def fn4(a):
            a[0] = 30
            print('a =',a,id(a))
        
        c = [1, 2, 3] 
        # fn4(c)  # c = [30, 2, 3]

        fn4(c.copy())   # c = [1, 2, 3]
        fn4(c[:])   # c = [1, 2, 3]
        # print('c =',c,id(c))
        ```

---

不定长参数

- 在定义函数时，可以在形参前边加上一个 `*`，这样这个形参将会获取到所有剩余的位置实参，并保存到一个**元组**中（装包）
    ```
    def sum(*nums):
        result = 0
        for n in nums :
            result += n
        print(result)
    
    sum(123,456,789,10,20,30,40)
    ```

- 带星号的形参只能有一个，可以和其他参数配合使用

- `*` 形参只能接收位置参数，而不能接收关键字参数

- 可变参数不是必须写在最后，但是带 `*` 的参数后的所有参数，必须以关键字参数的形式传递
    ```
    # 第一个参数给 a，剩下的位置参数作为元组给 b，c 必须使用关键字参数
    def fn2(a, *b, c):
        print('a =',a)
        print('b =',b)
        print('c =',c)
    
    fn2(1, 2, 3, 4, c = 5)

    # 如果在形参的开头直接写一个*,则要求我们的所有的参数必须以关键字参数的形式传递
    def fn2(*, a, b, c):
        print('a =', a)
        print('b =', b)
        print('c =', c)

    fn2(a = 3, b = 4, c = 5)
    ```

- `**` 形参可以接收其他的**关键字参数**，它会将这些参数统一保存到一个字典中
    - 字典的 `key` 就是参数的名字，字典的 `value` 就是参数的值
    - `**` 形参只能有一个，并且必须写在所有参数的**最后**
    ```
    def fn3(b, c, **a) :
        print('a =',a,type(a))
        print('b =',b)
        print('c =',c)

    fn3(b=1,d=2,c=3,e=10,f=20)
    ```

- 参数的解包（拆包）
    - 传递实参时，可以在序列类型的参数前添加星号，这样他会自动将序列中的元素依次作为参数传递
    - 这里要求序列中元素的个数必须和形参的个数的一致
        ```
        def fn4(a, b, c):
            print('a =',a)
            print('b =',b)
            print('c =',c)

        t = (10, 20, 30)
        fn4(*t) 
        ```
    - 通过 `**` 来对一个字典进行解包操作
        ```
        d = {'a':100,'b':200,'c':300}
        fn4(**d)
        ```

---

返回值
- 可以通过 `return` 来指定函数的返回值
    ```
    def fn():
        def fn2() :
            print('hello')

        return fn2 # 返回值也可以是一个函数
    
    r = fn()    # 返回一个函数
    r   # <fuction at 0x123>
    r() # 'hello'

    ```

- 如果仅写一个 `return` 或者不写，则相当于 `return None`
- 在函数中，`return` 后的代码都不会执行，`return` 一旦执行函数自动结束

---

文档字符串

- `help()` 是 Python 中的内置函数，可以查询函数的用法
    - 语法：`help(函数对象)`

    ```
    help(print) # 获取print()函数的使用说明
    ```

- 在定义函数时，可以在函数内部编写文档字符串（`doc str`）作为函数的说明，通过 `help()` 函数来查看函数的说明
    ```
    def fn(a: int, b: bool, c: str = 'hello') -> int:
        '''
        这是一个文档字符串的示例

        函数的作用：
        函数的参数：
            a，作用，类型，默认值
            b，作用，类型，默认值
            c，作用，类型，默认值
        '''
        return 10

    help(fn)
    ```

---

作用域（`scope`）

- 作用域指的是变量生效的区域
    ```
    b = 20 # 全局变量

    def fn():
        a = 10 # a定义在了函数内部，所以他的作用域就是函数内部，函数外部无法访问
    ```

- `全局作用域`
    - 全局作用域在程序执行时创建，在程序执行结束时销毁
    - 所有函数以外的区域都是全局作用域
    - 在全局作用域中定义的变量，都属于全局变量，全局变量可以在程序的任意位置被访问

- `函数作用域`
    - 函数作用域在函数调用时创建，在调用结束时销毁
    - 函数每调用一次就会产生一个新的函数作用域
    - 在函数作用域中定义的变量，都是局部变量，它只能在函数内部被访问   

-  变量的查找
    - 当我们使用变量时，会优先在当前作用域中寻找该变量，如果有则使用
    - 如果没有则继续去上一级作用域中寻找，直到找到全局作用域，依然没有找到，则会抛出异常 

- 如果希望在函数内部修改全局变量，则需要使用 `global` 关键字来声明变量

    ```
    a = 20

    def fn3():
        a = 10 # 默认为局部变量赋值
        global a # 声明在函数内部的 a 是全局变量，此时再去修改 a 就是在修改全局的 a
        a = 10 # 修改全局变量
        print('函数内部：','a =',a) # a = 10

    fn3()
    print('函数外部：','a =',a) # a = 10
    ```

---

命名空间（`namespace`）

- 命名空间指的是变量存储的位置，每一个变量都需要存储到指定的命名空间当中
    - 每一个作用域都会有一个它对应的命名空间
    - 全局命名空间，用来保存全局变量，函数命名空间用来保存函数中的变量
    - 命名空间实际上是一个专门用来存储变量的字典

- `locals()` 用来获取当前作用域的命名空间
    ```
    a = 20
    scope = locals()    # 当前命名空间

    print(type(scope))  # <class 'dict'>
    print(scope['a'])   # 20

    # 向 scope 中添加一个 key-value，相当于在全局中创建了一个变量（不建议）
    scope['c'] = 1000
    ```

- `globals()` 函数可以用来在任意位置获取全局命名空间
    ```
    def fn4():
        a = 10

        # 在函数内部调用 locals() 会获取到函数的命名空间
        scope = locals()
        # 通过 scope 来操作函数的命名空间（不建议）
        scope['b'] = 20 

        global_scope = globals()
        print(global_scope['a'])    # a = 20
        global_scope['a'] = 30  # 修改外部变量（不建议）

    fn4()
    print(a)    # a = 30
    ```

---

## 高阶函数